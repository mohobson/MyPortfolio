{% extends "layout.html" %}

{% block content %}
<h1>Portfolio Dashboard</h1>

<a href="{{ url_for('refresh_data') }}">Refresh Data</a>
<a href="{{ url_for('sector_breakdown') }}">Sector Breakdown</a>
<a href="{{ url_for('screener') }}">Screener</a>

<table>
    <thead>
        <tr>
            <th>Ticker</th>
            <th>Shares</th>
            <th>Stock Price</th>
            <th>Market Value</th>
            <th>Profit/Loss</th>
            <th>% of Portfolio</th>
            <th>Analyst Rating</th>
            <th>Price Target</th>
            <th>Sector</th>
        </tr>
    </thead>
    <tbody>
        {% for row in portfolio.itertuples() %}
        <tr>
            <td>{{ row.Ticker }}</td>
            <td>{{ row.Shares }}</td>
            <td>${{ row.Stock_Price }}</td>
            <td>${{ row.Market_Value }}</td>
            <td>${{ row.Profit_Loss }}</td>
            <td>{{ "%.2f" % (row.Percent_of_Portfolio or 0) }}%</td>
            <td>{{ row.Analyst_Rating }}</td>
            <td>
                <form action="{{ url_for('update_price_target') }}" method="POST">
                    <input type="hidden" name="ticker" value="{{ row.Ticker }}">
                    <input type="number" step="0.5" name="price_target" value="{{ row.Price_Target or 0 }}">
                    <button type="submit">Update</button>
                </form>
            </td>
            <td>{{ row.Sector }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
